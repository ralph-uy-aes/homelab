# Chapter 4: Cryptography - Module A: Public Key Infrastructure

#### Digital Certificates
- A and B want to set up a secure communication session
- A can send B a session key encrypted using B's public key
- However this does not protect from impersonation, if an interceptor has access to either public key
- Digital certificates or public key certificates are used to prevent this
    - Includes information such as the hash of the key itself, starting and ending dates for validity, and intended purposes of the key

#### Trust Models
- Self-signed
    - Signed only with its owner's private key
    - Works just fine for key exchange and encryption
    - Doesn't give authentication on its own
    - Issuer says "trust me, I am who I say I am"
- Public Key Infrastructure
    - Certificate is registered and signed by a central and respected certificate authority (CA) to vouch for authenticity
    - CA can revoke and issue new certificates
    - X.509 standard is used by PKI and self-signed keys
    - PKI encompasses the following trust models:
        - Hierarchical or tree model
            - All trust relationships go back to a single root CA
            - Small organizations may have a single CA that issues certificates directly to end-users
            - Large trees maintained by a public CA could have several intermediate CA levels
        - Bridge model
            - Multiple root CAs can exist
            - Root CAs each issue a certificate to the other
            - Certificates must always trace back to root CA, but can verify other CAs and link trees
        - Mesh model
            - CAs don't maintain a strict hierarchy
            - Issues cross-certificates to each other
            - Mesh can be flexible, but also easy to compromise
        - Hybrid model
            - Combines elements of the hierarchical, bridge, and mesh models
            - Could mean a lot of things
- Web of trust
    - Certificate is signed by one or more third parties to form a decentralized network of trust relationships
    - If you trust any of the people who have signed the certificate, you should trust its owner
    - Much like a PKI mesh model, but based on end users rather than CAs
    - Pretty Good Privacy (PGP) system uses this mode by default
    - Webs can be constructed quickly by using a key-signing party
        - Gathering where many people can exchange and verify public keys at once
    - Revocation is complicated because a key's owner can revoke it and signatories can revoke their signatures

#### Certificate Formats
- The most popular standard is X.509
    - Defined by ITU-T in 1988
    - Can technically be used in a web of trust model, but almost always used as part of a strict hierarchical model
    - Used for IETF's PKI standard
- Typical certificates include:
    - Version: Certificate's X.509 version 
    - Serial number: Unique to each certificate generated by a CA
    - Issuer: Name of the certificate's creator, usually a CA unless self-signed
    - Subject: Name of certificate's subject or owner formatted as an X.509 distinguished name (DN)
    - Validity: Start and end dates for certificate's validity (usually no more than 2-3 years)
    - Public key: Subject's public key as well as algorithm used
    - Signature: Issuer's digital signature as well as algorithm used
    - Extensions: Additional information included by certificate issuer
- OpenPGP is another format, the most popular choice for web of trust systems

#### Certificate Types
- Domain Validation
    - Used to identify DNS host or domain name for TLS-protected protocols like HTTPS
    - Contains a single common name (CN)
    - Public CAs typically issue domain validation certificates instantly and require only proof of control of the domain's WHOIS, DNS, hosting account, or email of the corresponding domain
- User or machine authentication
    - Used to identify and entity like a user or computer
    - Machine or computer certificates are used to identify servers or authenticate client machines on the network
    - User certificates are used for smart card authentication, email authentication, EFS file encryption, or other situations where a specific user must be identified
- Email (S/MIME)
    - Usable for sending and receiving S/MIME email messages with signed or encrypted content
    - Typical example of a limited certificate, only require that your prove you own the email address
- Code signing
    - Used to sign an executable file to authenticate its source and guarantee its integrity
    - Before installing an application or driver, an operating system can verify the signature to ensure the file hasn't been forged
    - Code signing must only be issued to trusted developers
- Qualified
    - Used to cerate qualified electronic signatures which are digital signatures that have the legal standing of handwritten signatures on documents
- Subject Alternative Name (SAN)
    - Allows certificate to contain multiple names such as multiple website domain names
- Wildcard
    - Multi-domain certificate that can apply to any number of subdomains within a single domain
- Extended Validation (EV)
    - Certificate backed by stricter identity validation process than the CA's default
    - For SSL certificates used on the web, sites with a valid EV certificate shows a green color or lock in the browser's address bar

#### Certificate Generation
1. Applicant generates a key pair and keeps the private key secret
2. Applicant presents the public key to the CA along with a certificate signing request (CSR)
3. CA verifies the applicant's identity according to its CPS, might involve checking credentials, contacting the applicant, or performing investigations
4. CA signs the certificate and disseminates it to the applicant and the CA's repository sites

#### Certificate Expiration
- When a certificate expires, the CA must renew it by issuing a new certificate
- Same process as generation, but validation may be streamlined
- Sometimes renewal doesn't even require a new CSR

#### Certificate Revocation
- Certificates are revoked for various reasons
    - Ex. Issued by mistake, holder violated CA policies
- X.509 standard defines two revocation states
    - Revoked: Certificate is irreversibly invalidated and a new one must be issued
    - Hold: Certificate is temporarily invalid, but can be reinstated or permanently revoked later, used when a permanent decision isn't available yet
- Two mechanisms:
    - Certificate Revocation List (CRL)
        - A list containing the serial numbers of all revoked certificates
        - Regularly published to a website for clients to access
        - Signed by the CA to authenticate it
    - Online Certificate Status Protocol (OCSP)
        - Request/response protocol used over HTTP
        - Client uses OCSP to contact the CA directly and ask about revocation status of a particular certificate
        - Much smaller than a full CRL
        - Saves significantly on network resources and doesn't rely on publication periods, can always be up to date